<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<title>Noel ğŸ„</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link rel="website icon" type="png" href="icon noel.svg">
<style>
  body {
    margin: 0;
    height: 100vh;
    background: linear-gradient(135deg,#0f2027,#203a43,#2c5364);
    font-family: Arial, sans-serif;
    color: #fff;
    display: flex;
    justify-content: center;
    align-items: center;
    overflow: hidden;
  }

  #snow {
    position: fixed;
    inset: 0;
    pointer-events: none;
    z-index: 1;
  }

  .box {
    background: rgba(255,255,255,0.12);
    padding: 30px;
    border-radius: 14px;
    text-align: center;
    z-index: 10;
    width: 320px;
  }

  input, button {
    width: 100%;
    padding: 10px;
    margin-top: 10px;
    border-radius: 6px;
    border: none;
    font-size: 16px;
  }

  button {
    background: #e63946;
    color: #fff;
    cursor: pointer;
  }

  .hidden { display: none; }

  /* ===== QUÃ€ ===== */
  .gifts {
    position: fixed;
    inset: 0;
    z-index: 20;
  }

  .gift {
    position: absolute;
    font-size: 90px;
    cursor: pointer;
    animation: float 5s ease-in-out infinite;
  }

  .gift.opened {
    opacity: 0.4;
    pointer-events: none;
  }

  @keyframes float {
    0%,100% { transform: translateY(0); }
    50% { transform: translateY(-25px); }
  }

  @keyframes shake {
    0% { transform: rotate(0); }
    25% { transform: rotate(-10deg); }
    50% { transform: rotate(10deg); }
    75% { transform: rotate(-10deg); }
    100% { transform: rotate(0); }
  }

  .shake { animation: shake 0.6s; }

  .popup {
    position: fixed;
    top: 50%;
    left: 50%;
    transform: translate(-50%,-50%);
    background: rgba(0,0,0,0.85);
    padding: 25px;
    border-radius: 14px;
    z-index: 999;
    text-align: center;
  }

  .box {
    position: absolute;
  }

</style>
</head>

<body>
<iframe
  src="music.html"
  style="display:none"
  id="musicFrame">
</iframe>

<canvas id="snow"></canvas>
<div class="box" id="introBox">
  <h2>ğŸ„ Má»™t lá»i nháº¯n nhá»</h2>
  <p style="line-height:1.6">
    Wow váº­y bÃ¢y giá» Ä‘Ã£ lÃ  giÃ¡ng sinh rá»“i Ä‘Ã³ Æ°,<br>
    tui cÃ³ 1 mÃ³n quÃ  dÃ nh táº·ng cho báº¡n,<br>
    má»Ÿ quÃ  cho vui nhÃ©! VÃ  nhá»› ghi láº¡i mÃ n hÃ¬nh Ä‘á»ƒ xem láº¡i sau nÃ yâ€ âœ¨
  </p>
  <button onclick="startExperience()">ğŸ Báº¯t Ä‘áº§u</button>
</div>

<div class="box hidden" id="loginBox">
  <h2>ğŸ„ Noel ğŸ„</h2>
  <input type="password" id="password" placeholder="Máº­t kháº©u">
  <button onclick="checkPassword()">XÃ¡c nháº­n</button>
</div>

<div class="gifts" id="gifts" style="display:none">
  <div class="gift" data-id="0" onclick="openGift(this)">ğŸ</div>
  <div class="gift" data-id="1" onclick="openGift(this)">ğŸ</div>
  <div class="gift" data-id="2" onclick="openGift(this)">ğŸ</div>
  <div class="gift" data-id="3" onclick="openGift(this)">ğŸ</div>
  <div class="gift" data-id="4" onclick="openGift(this)">ğŸ</div>
  <div class="gift" data-id="5" onclick="openGift(this)">ğŸ</div>
</div>

<script>
  function startApp() {
  document.getElementById("musicFrame").src = "music.html";
}

function startExperience() {
  document.getElementById("introBox").classList.add("hidden");
  document.getElementById("loginBox").classList.remove("hidden");

  // kÃ­ch hoáº¡t iframe nháº¡c (user interaction â†’ khÃ´ng bá»‹ cháº·n)
  document.getElementById("musicFrame").src = "music.html";
}

let openedCount = Number(localStorage.getItem("openedCount")) || 0;
let openedGifts = JSON.parse(localStorage.getItem("openedGifts")) || [];
let stage = localStorage.getItem("stage") || "login";
let isOpening = false; // khÃ³a animation
const PASSWORD = "1";
const CUSTOM_URL = "noel_v2.html"; 

const giftPool = [
  "ğŸŒŸ Háºµn 50k luÃ´n má»Ÿ hay ta",
  "â¤ï¸ Wow bá»‘c trÃºng 1 ly trÃ  sá»¯a nhÃ©",
  "ğŸ‰ TrÃºng Ä‘Æ°á»£c quÃ  20k nÃ¨",
  "ğŸ€ KhÃ´ng cÃ³ quÃ  rá»“i. ChÃºc may máº¯n láº§n sau",
  "âœ¨ QuÃ  nÃ y hÆ¡i nhá» 10k thoi",
  "ğŸ„ Bá»‹ch bÃ¡nh nÃ¨",
  "ğŸ’Œ Combo bÃ¡nh trÃ¡ng, trÃ  sá»¯a"
];

function assignRandomGifts() {
  const gifts = document.querySelectorAll(".gift");

  const shuffled = [...giftPool].sort(() => Math.random() - 0.5);

  gifts.forEach((gift, index) => {
    gift.dataset.gift =
      shuffled[index % shuffled.length];
  });
}

function checkPassword() {
  if (password.value === PASSWORD) {
    loginBox.style.display = "none";
    gifts.style.display = "flex";
  } else {
    alert("Sai máº­t kháº©u âŒ");
  }
}

function openGift(el) {
  if (isOpening) return;

  const id = Number(el.dataset.id);

  if (openedGifts.includes(id)) return;
  if (openedCount >= 3) return;

  isOpening = true;
  el.classList.add("shake");

  setTimeout(() => {
    el.classList.remove("shake");
    el.classList.add("opened");
    el.textContent = "âœ¨";

    openedCount++;
    openedGifts.push(id);

    localStorage.setItem("openedCount", openedCount);
    localStorage.setItem("openedGifts", JSON.stringify(openedGifts));

    showPopup(el.dataset.gift);

    if (openedCount === 3) {
      localStorage.setItem("stage", "action");
      showActionBox();
    }

    isOpening = false;
  }, 600);
}

function showPopup(text) {
  // CHá»ˆ xÃ³a popup quÃ  táº¡m thá»i
  document.querySelectorAll(".gift-popup").forEach(p => p.remove());

  const p = document.createElement("div");
  p.className = "popup gift-popup";
  p.innerHTML = `
    ${text}<br><br>
    <button onclick="this.parentElement.remove()">ÄÃ³ng</button>
  `;
  document.body.appendChild(p);
}

function goWish() {
  window.location.href = "wish.html";
}

function goCustom() {
  window.location.href = CUSTOM_URL;
}

function goExtra() {
  window.location.href = "noel_v3.html";
}

/* ===== TUYáº¾T ===== */
const canvas = document.getElementById("snow");
const ctx = canvas.getContext("2d");
let w = canvas.width = innerWidth;
let h = canvas.height = innerHeight;

const flakes = Array.from({length:120}, () => ({
  x: Math.random()*w,
  y: Math.random()*h,
  r: Math.random()*3+1,
  d: Math.random()+1
}));

function snow() {
  ctx.clearRect(0,0,w,h);
  ctx.fillStyle = "rgba(255,255,255,0.8)";
  ctx.beginPath();
  flakes.forEach(f=>{
    ctx.moveTo(f.x,f.y);
    ctx.arc(f.x,f.y,f.r,0,Math.PI*2);
  });
  ctx.fill();

  flakes.forEach(f=>{
    f.y += f.d*f.d;
    if (f.y>h) { f.y=0; f.x=Math.random()*w; }
  });
  requestAnimationFrame(snow);
}
snow();

window.onload = () => {
  randomizeGiftPositions();
  assignRandomGifts();
  document.querySelectorAll(".gift").forEach(gift => {
  const id = Number(gift.dataset.id);
  if (openedGifts.includes(id)) {
    gift.classList.add("opened");
    gift.textContent = "âœ¨";
    gift.style.pointerEvents = "none";
  }
});
  if (stage === "action") {
    loginBox.classList.add("hidden");
    gifts.style.display = "none";
    showActionBox();
  }
};

function randomizeGiftPositions() {
  const gifts = document.querySelectorAll(".gift");

  gifts.forEach(gift => {
    const top = Math.random() * 60 + 15;   // 15% â†’ 75%
    const left = Math.random() * 70 + 10;  // 10% â†’ 80%

    gift.style.top = top + "%";
    gift.style.left = left + "%";
  });
}

function showActionBox() {
  document.getElementById("actionBox").classList.remove("hidden");

  document.querySelectorAll(".gift:not(.opened)").forEach(g => {
    g.style.opacity = "0.3";
    g.style.pointerEvents = "none";
  });
}

</script>
<div class="popup hidden" id="actionBox">
  <b>ğŸ Báº¡n Ä‘Ã£ chá»n Ä‘á»§ 3 mÃ³n quÃ , hÃ£y chá»n Ä‘iá»u báº¡n muá»‘n xem tiáº¿p?</b><br><br>
  <button onclick="location.href='wish.html#action'">âœ‰ï¸ Xem lá»i chÃºc</button><br><br>
  <button onclick="goCustom()">ğŸ„ Xem cÃ¢y noel</button>
  <button onclick="goExtra()">â­ Xem cÃ¢y khÃ¡c</button>
</div>
</body>
</html>
